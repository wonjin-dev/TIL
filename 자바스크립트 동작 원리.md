# 자바스크립트 동작 원리

**_1. DOM 이벤트, http 요청, setTimeout 등과 같은 비동기 함수는 web API를 호출한다_**
**_2. web API는 콜백 함수를 콜백 큐에 저장한다_**
**_3. 큐는 대기하다가 스택이 텅 비는 시점에 콜백을 실행시켜 완전하게 처리한다_**

## Heap Memory

객체 또는 동적인 데이터가 **_저장되는 공간_**이다. 메모리의 가장 큰 영역이며 가비지컬렉션이 발생한다<br>
`New space`: 새로운 객체가 저장되는 곳이다. 이 객체들은 짧은 생명주기를 가지며 Scavenger(Minor GC)에 의해 관리된다<br>
`Old space`: 두 번의 마이너 가비지 컬렉션 주기동안 New space에서 살아남은 객체들이 이동되어 관리된다. 이들은 Major GC에 의해 관리된다

### garbage collection

메모리 관리 기법 중의 하나로, 프로그램이 동적으로 할당했던 메모리 영역 중에서 필요없게 된 영역을 해제하는 기능<br>
_`Minor GC`_

- Scavenger라고도 하며 New space영역을 정리하는 역할을 한다<br>(`Scavenger`: 객체가 참조하는 다른 객체가 없으면 객체를 제거하는 알고리즘)
- 새 객체를 위한 공간을 예약하려고 할 때마다 증가하는 할당 포인터가 있는데 이 포인터가 공간의 끝에 도달하면 Minor GC가 트리거된다
- 자주 발생. 매우 빠르게 진행된다<br>

_`Major GC`_

- Major GC는 Old space를 정리하는 역할을 한다
- V8 엔진이 Old space가 공간이 부족하다고 판단할 때 트리거된다
- Minor GC에서 사용한 Scavenger 알고리즘은 작은 데이터 크기에 적합하다. 메모리 오버헤드가 발생하므로 Old 영역에는 적합하지 않다. 따라서 Major GC에서는 Mark-Sweep-Compact 알고리즘을 사용하여 가비지컬렉터를 수행한다<br>
  _Mark-Sweep-Compact_: <br>살아있는 객체를 식별하고 (Mark) <br>Old영역의 가장 앞부분 부터 살아 있는 것만 남기고 삭제하며 (Sweep)<br> 마지막으로 살아있는 객체들을 가장 앞쪽으로 모아준다 (Compact)

## Call Stack

자바스크립트는 싱글 쓰레드 기반 언어라고 표현한다<br>
즉, 호출 스택이 하나라는 의미이다. 따라서 한 번에 한 개의 작업만 처리한다
스택은 기본적으로 프로그램에서 현재 위치를 기록하는 자료구조이다<br>함수를 실행하면, 해당 함수는 호출 스택의 가장 상단에 위치하여, 함수의 실행이 끝날 때 해당 함수를 스택에서 제거한다

### Stack over flow

스택의 사이즈를 초과 했을 때 발생하는 오류<br> 대표적인 예시로 함수 본인이 본인을 호출하는 재귀함수가 대표적이다

## Callback Queue

자바스크립트에서는 하나의 호출 스택만 있기 때문에, 하나의 함수 처리가 엄청 느려서 다른 함수 실행에 지장을 줄 때 비동기 콜백을 사용하여 해결한다<br>
비동기 콜백은 동기 함수와는 다르게 특수한 시점에 실행하기 때문에 스택 안에 바로 push 될 필요없다
쉽게 생각하면 큐는 스택이 하나인 자바스크립트를 위한 예비 스택같은 곳

### Queue

- `task`와 `microtask`(비동기 작업) 그리고 `animationFrame` 작업으로 구분된다 (실제로는 더 많다)
- web API의 종류에 따라 다른 Queue로 이동

## Event Loop

Event Loop는 stack을 감시하다가 stack이 비었을 때 Queue에서 작업들을 꺼내어 처리한다
<br>`Microtask Queue - Animation Frames - Task Queue` 순서로 Queue의 작업이 처리된다
